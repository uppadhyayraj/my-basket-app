# 1.2.4 Security & Performance Audit - Questions & Responses

## Question 1: API Gateway Rate-Limiting Configuration

### Question
Conduct a security and performance audit of our architecture and locate the definition for the API Gateway's rate-limiting and routing rules.

Identify the specific configuration file (e.g., within microservices/api-gateway/) where these limits are declared.

Analyze the code to find the requests per minute (RPM) threshold.

Specifically, identify the value that triggers a 429 (Too Many Requests) error.

Please provide the full file path and the exact numeric value found.

### Response

The rate-limiting rules are defined in `microservices/api-gateway/src/index.ts`.

**File Path:** `microservices/api-gateway/src/index.ts` (lines 18-22)

**Rate Limit Configuration:**
```typescript
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 1000, // Limit each IP to 1000 requests per windowMs
  message: 'Too many requests from this IP, please try again later.',
});
```

**Key Metrics:**
- **Time Window:** 15 minutes (900,000 milliseconds)
- **Max Requests:** **1000 requests per 15-minute window**
- **Requests Per Minute (RPM):** ~67 RPM (1000 ÷ 15)
- **HTTP Status Code:** 429 (Too Many Requests) - triggered when threshold exceeded

**Additional Context:**
The rate limiter is applied globally to all routes via `app.use(limiter)` in the middleware stack, affecting all incoming requests to the API Gateway on port 3000.

---

## Question 2: Burst vs. Sustained Traffic Handling

### Question
How does this rate-limiter handle burst traffic vs. sustained traffic?

### Response

The current rate-limiter uses a **fixed window** approach, which handles these scenarios differently:

#### Burst Traffic
**Behavior:** The limiter allows bursts up to the maximum threshold within each 15-minute window.

- **Example:** 1000 requests in the first 30 seconds → ✅ **Allowed** (under the 1000 limit)
- **Gotcha:** All 1000 requests can be consumed instantly, leaving no capacity for the remaining 14.5 minutes

#### Sustained Traffic
**Behavior:** Consistent traffic across the window is well-managed until the threshold is hit.

- **Example:** ~67 requests per minute for 15 minutes → ✅ **Allowed** (hits exactly 1000)
- **Better fairness:** Traffic is distributed, reducing 429 errors for normal usage patterns

#### Key Limitations

| Aspect | Issue |
|--------|-------|
| **Boundary Problem** | A spike at minute 14:59 + another at minute 15:01 could allow 2000 requests in 2 minutes (window edge collision) |
| **No Gradual Backoff** | Once limit is hit, requests are instantly rejected until the window resets |
| **Unfair to Early Users** | Users hitting the service early in the window consume quota, penalizing late-window traffic |

#### Recommendation
For better burst handling, consider a **sliding window** or **token bucket** algorithm to smooth traffic and prevent the edge-case exploitation.
