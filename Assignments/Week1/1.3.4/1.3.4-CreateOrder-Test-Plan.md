# CreateOrder Function - Test Plan

**Target Service:** Order Service  
**Function:** `createOrder(userId: string, orderData: CreateOrderRequest)`  
**Test Date:** January 27, 2026  
**Test Environment:** Unit/Integration Testing  

---

## Overview
This test plan covers comprehensive testing of the CreateOrder function including positive cases (happy path), negative cases (invalid inputs), and edge cases. Special focus on data integrity and order total calculation accuracy.

---

## Happy Path Cases

| Test ID | Description | Steps | Expected Result |
|---------|-------------|-------|-----------------|
| HP-001 | Create order with valid single item | 1. Call createOrder with userId "user123" and valid order data with 1 item (price: $10.00, qty: 1)<br>2. Verify order object returned<br>3. Check order is stored | Order created successfully with ID generated, status = PENDING, totalAmount = $10.00, order stored in orders map |
| HP-002 | Create order with multiple items | 1. Call createOrder with userId "user456" and order data with 3 items<br>2. Item 1: $15.50 × 2<br>3. Item 2: $8.25 × 1<br>4. Item 3: $12.99 × 3<br>5. Verify returned order | Order created with totalAmount = $78.47, all 3 items stored, status = PENDING |
| HP-003 | Verify order stored in user orders list | 1. Create order for userId "user789"<br>2. Call getUserOrders for same userId<br>3. Verify order appears in list | Order appears in user's orders list at index 0 (newest first) |
| HP-004 | Verify cart cleared after order creation | 1. Create order for userId "user001"<br>2. Verify cartClient.clearCart() was called<br>3. Verify no exceptions thrown | Cart successfully cleared for user after order creation, warning not logged |
| HP-005 | Verify all required order fields populated | 1. Create order with complete order data<br>2. Inspect returned Order object | Order contains: id (UUID), userId, items, totalAmount, status (PENDING), shippingAddress, billingAddress, paymentMethod, orderDate, estimatedDelivery, createdAt, updatedAt |
| HP-006 | Verify timestamps are set | 1. Record current time<br>2. Create order<br>3. Compare timestamps | orderDate, createdAt, and updatedAt are set to current time (within 1 second) |
| HP-007 | Verify estimated delivery calculated | 1. Create order<br>2. Check estimatedDelivery date | estimatedDelivery is exactly 5 days from current date |
| HP-008 | Create order with shipping = billing address | 1. Create order using same Address object for both shipping and billing<br>2. Verify order created | Order created successfully with identical shipping and billing addresses |
| HP-009 | Create multiple orders for same user | 1. Create order 1 for userId "multi-user"<br>2. Create order 2 for same userId (different items)<br>3. Get all user orders | Both orders stored for user, newest order at index 0, both orders retrievable |
| HP-010 | Create order with various payment methods | 1. Create order with paymentMethod type = "credit_card", brand = "Visa", last4 = "4242"<br>2. Verify order created | Order created with payment method stored correctly |

---

## Negative Cases

| Test ID | Description | Steps | Expected Result |
|---------|-------------|-------|-----------------|
| NEG-001 | Create order with null items | 1. Call createOrder with userId "user123" and orderData with items = null<br>2. Observe error thrown | Error thrown: "Order must contain at least one item" |
| NEG-002 | Create order with undefined items | 1. Call createOrder with userId "user123" and orderData with items = undefined<br>2. Observe error thrown | Error thrown: "Order must contain at least one item" |
| NEG-003 | Create order with empty items array | 1. Call createOrder with userId "user123" and orderData with items = []<br>2. Observe error thrown | Error thrown: "Order must contain at least one item" |
| NEG-004 | Create order with empty userId | 1. Call createOrder with userId = ""<br>2. Verify order creation | Order created with empty string as userId (userId validation not enforced in this function) |
| NEG-005 | Create order with null userId | 1. Call createOrder with userId = null<br>2. Observe result | Order created with null userId, or TypeError thrown depending on implementation |
| NEG-006 | Create order with item quantity = 0 | 1. Call createOrder with item quantity = 0<br>2. Verify order total calculation | Order created with totalAmount = 0 for that item (quantity validation not enforced) |
| NEG-007 | Create order with negative item price | 1. Call createOrder with item price = -$10.00, quantity = 1<br>2. Check totalAmount | Order created with negative totalAmount (price validation not enforced) |
| NEG-008 | Create order with negative quantity | 1. Call createOrder with item quantity = -5<br>2. Check order creation | Order created with negative totalAmount (negative quantity allowed) |
| NEG-009 | Cart clear fails but order still created | 1. Mock cartClient.clearCart() to throw error<br>2. Create order<br>3. Verify order status | Order created successfully, console.warn() called with error message, order NOT rolled back |
| NEG-010 | Create order missing shippingAddress | 1. Call createOrder with shippingAddress = undefined<br>2. Verify order creation | Order created with undefined shippingAddress (no validation on required fields) |
| NEG-011 | Create order missing billingAddress | 1. Call createOrder with billingAddress = undefined<br>2. Verify order creation | Order created with undefined billingAddress |
| NEG-012 | Create order missing paymentMethod | 1. Call createOrder with paymentMethod = undefined<br>2. Verify order creation | Order created with undefined paymentMethod |

---

## Edge Cases

| Test ID | Description | Steps | Expected Result |
|---------|-------------|-------|-----------------|
| EDGE-001 | Create order with very small decimal amounts | 1. Create order with item: price = $0.01, qty = 1<br>2. Verify totalAmount | Order created with totalAmount = $0.01 |
| EDGE-002 | Create order requiring rounding (3+ decimals) | 1. Create order with item: price = $10.33, qty = 3<br>2. Calculate: $10.33 × 3 = $30.99<br>3. Verify totalAmount rounded to 2 decimals | Order created with totalAmount = $30.99 (rounded correctly to 2 decimal places) |
| EDGE-003 | Create order with rounding .005 (banker's rounding) | 1. Create order with item: price = $0.035, qty = 1<br>2. Verify totalAmount rounding | Order created with totalAmount properly rounded using Math.round() to 2 decimals |
| EDGE-004 | Create order with large quantity | 1. Create order with item: price = $1.00, qty = 999999<br>2. Verify totalAmount | Order created with totalAmount = $999999.00 |
| EDGE-005 | Create order with very large price | 1. Create order with item: price = $999999.99, qty = 1<br>2. Verify totalAmount | Order created with totalAmount = $999999.99 |
| EDGE-006 | Create order with many items (100+) | 1. Create order with 150 different items<br>2. Verify all items stored<br>3. Verify totalAmount calculated correctly | All 150 items stored in order, totalAmount correctly sums all items |
| EDGE-007 | Create orders in rapid succession | 1. Create 10 orders for same userId in quick succession<br>2. Verify all stored<br>3. Verify order in correct sequence | All 10 orders created with unique IDs, stored in newest-first order |
| EDGE-008 | Data integrity: Fractional cent accumulation | 1. Create order with 3 items at $0.01 each<br>2. Create order with item at $3.03 qty 1<br>3. Compare: should not accumulate floating point errors | Each order has correct totalAmount with no floating point errors, both orders total correctly |
| EDGE-009 | UUID uniqueness across multiple orders | 1. Create 100 orders for same user<br>2. Collect all order IDs<br>3. Check for duplicates | All 100 order IDs are unique (no duplicate UUIDs) |
| EDGE-010 | Order status always PENDING for new orders | 1. Create 20 orders with varying data<br>2. Verify status of all orders | All 20 new orders have status = OrderStatus.PENDING |
| EDGE-011 | Create order with special characters in addresses | 1. Create order with shippingAddress containing special chars: "123 O'Brien St.", "São Paulo"<br>2. Verify order creation | Order created successfully, special characters preserved in address |
| EDGE-012 | Multiple users creating orders simultaneously | 1. Create order for userId "user-a"<br>2. Create order for userId "user-b"<br>3. Create order for userId "user-c"<br>4. Verify each user's order list | Each user has only their own order(s), no cross-user contamination |

---

## Data Integrity Test Cases

| Test ID | Description | Steps | Expected Result | Validation |
|---------|-------------|-------|-----------------|-----------|
| DI-001 | Order total = sum of all items (exact match) | 1. Create order with items: [$15.00 × 2], [$10.00 × 1]<br>2. Manual calculation: (15.00 × 2) + (10.00 × 1) = $40.00<br>3. Retrieve order<br>4. Compare totalAmount | order.totalAmount = $40.00 | Manual math: 30 + 10 = 40 ✓ |
| DI-002 | Order total decimal precision (2 decimal places) | 1. Create order with items: [$7.99 × 3], [$2.50 × 2]<br>2. Calculation: (7.99 × 3) + (2.50 × 2) = $23.97 + $5.00 = $28.97<br>3. Check totalAmount has exactly 2 decimals | order.totalAmount = 28.97<br>No trailing zeros, no more/less than 2 decimals | Verify length of decimal portion |
| DI-003 | Rounding applied correctly (Math.round test) | 1. Create order with item: price = $10.126 (3 decimals), qty = 1<br>2. Raw calc: 10.126 × 1 = 10.126<br>3. Expected: Math.round(10.126 × 100) / 100 = 10.13 | order.totalAmount = 10.13 | Should round UP from .126 to .13 |
| DI-004 | No floating point errors (0.1 + 0.2 problem) | 1. Create order with 10 items each at $0.10<br>2. Expected total: $1.00<br>3. Verify no floating point artifacts | order.totalAmount = 1.00 exactly | No 0.9999999 or 1.0000001 |
| DI-005 | Items array preserved exactly | 1. Create order with 5 items, note all item properties<br>2. Retrieve order<br>3. Compare items array | All 5 items in order.items exactly match input, including id, name, price, quantity, description, image, dataAiHint | Deep equality check on items |
| DI-006 | Order total consistency across multiple calculations | 1. Create 5 orders with various items<br>2. For each order, manually recalculate total from items<br>3. Compare to stored totalAmount | All 5 orders have totalAmount matching manual calculations | Use calculator to verify each |
| DI-007 | Zero total edge case | 1. Create order with item: price = $0.00, qty = 1<br>2. Verify totalAmount | order.totalAmount = 0.00 | Exact zero, not negative or null |
| DI-008 | Rounding consistency (same input always same output) | 1. Create order 1 with item: $3.335, qty = 1<br>2. Create order 2 with same item data<br>3. Compare totalAmount of both orders | Both orders have identical totalAmount | Should be deterministic |

---

## Test Execution Notes

### Setup Requirements
- **Test Database**: In-memory Map (existing implementation)
- **Mock Services**: Mock CartServiceClient for cart clearing
- **Test Data**: Create test fixtures with various CartItem arrays

### Assumptions
- UUID generation works correctly (v4 package functioning)
- Current date/time is accessible
- CartClient.clearCart() is callable

### Known Limitations
- No input validation on userId, addresses, or paymentMethod (tested as-is)
- No validation on item prices or quantities
- Cart clear failures do not prevent order creation (by design)

### Test Metrics
- **Total Test Cases**: 42
- **Happy Path Cases**: 10
- **Negative Cases**: 12
- **Edge Cases**: 12
- **Data Integrity Cases**: 8

---

## Risk Assessment

| Risk | Impact | Mitigation |
|------|--------|-----------|
| Floating point calculation errors | HIGH | Use DI test cases to verify rounding always produces 2 decimals |
| Order total calculation incorrect | HIGH | Verify Math.round() formula: `(sum × 100) / 100` produces correct result |
| Items not stored completely | MEDIUM | Test items array preservation (DI-005) |
| Duplicate UUIDs generated | MEDIUM | Test UUID uniqueness (EDGE-009) |
| Cart not cleared on order creation | MEDIUM | Mock and verify clearCart() call (HP-004) |
| Multi-user order mixing | MEDIUM | Test user isolation (EDGE-012) |

